---
title: Segurança, Privacidade e LGPD
description: 'Como garantimos a integridade e o sigilo dos dados sensíveis'
---

No VínculoTEA, lidamos com dados sensíveis de menores e informações de saúde. Por isso, a segurança não é uma camada extra, mas a base de nossa construção.

## Camadas de Proteção

### 1. Autenticação e Identidade (Supabase Auth)
- Hashing de Senhas: Utilizamos o algoritmo Argon2 para garantir que nem mesmo nós saibamos as senhas dos usuários.
- Sessões Seguras: Tokens JWT com expiração curta e refresh tokens rotativos.
- Recuperação de Acesso: Fluxo seguro via e-mail com tokens de uso único.

### 2. Row Level Security (RLS) - O Guardião do Banco
Implementamos políticas de RLS no PostgreSQL onde cada linha de tabela conhece seu dono ou quem tem permissão para vê-la.
- Isolamento de Escola: Usuários da Escola A nunca verão dados da Escola B.
- Privacidade do Aluno: Somente professores vinculados à turma/aluno podem acessar o prontuário.

```sql
-- Exemplo de política RLS simplificada
CREATE POLICY "Professores podem ver apenas seus alunos"
ON public.Alunos
FOR SELECT
USING (
  auth.uid() IN (
    SELECT user_id FROM public.Professor_Vinculo WHERE aluno_id = Alunos.id
  )
);
```

### 3. Criptografia em Trânsito
Toda comunicação entre o navegador do usuário e nossos servidores é feita via TLS 1.3 (HTTPS), garantindo que os dados não sejam interceptados.

---

## Auditoria e Logs de Acessos

Para conformidade com a LGPD e rastreabilidade total, o VinculoTEA utiliza um sistema de auditoria de dados:

### Estrutura da Tabela de Auditoria
```sql
CREATE TABLE public.logs_auditoria (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    created_at TIMESTAMPTZ DEFAULT now(),
    usuario_id UUID REFERENCES auth.users(id),
    plataforma_id UUID,
    acao TEXT NOT NULL, -- Ex: 'UPDATE_PEI', 'VIEW_PRONTUARIO'
    tabela TEXT,
    registro_id TEXT,
    dados_anteriores JSONB,
    dados_novos JSONB,
    ip_address TEXT,
    user_agent TEXT
);
```

### Auditoria de RLS
Todas as tabelas críticas possuem filtros rigorosos por `plataforma_id` e `auth.uid()`. Para auditar as permissões:
1. Verifique se a política `SELECT` exige que `plataforma_id` do registro coincida com o do usuário autenticado.
2. Utilize o comando `EXPLAIN` para garantir que o PostgreSQL está aplicando o filtro de isolamento antes da execução da query.

## Rollback de Usuários Órfãos
Em processos de criação de novas contas, utilizamos transações atômicas ou funções PostgreSQL (RPC) que garantem que, se o perfil do usuário não for criado com sucesso, o registro em `auth.users` seja removido automaticamente, evitando inconsistências no banco de dados.

<Info>
  A auditoria interna é revisada mensalmente para garantir que nenhum acesso indevido ocorra e que a privacidade dos alunos seja mantida em conformidade com as normas vigentes.
</Info>
